<!DOCTYPE html>
<html>
<head>
  <title>Naive Theories</title>

  <!-- jsPsych core -->
  <script src="https://unpkg.com/jspsych@8.0.0"></script>
  <link href="https://unpkg.com/jspsych@8.0.0/css/jspsych.css" rel="stylesheet" />

  <!-- jsPsych plugins -->
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.2.1"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey@2.0.0"></script>

  <!-- stimulus file -->
  <script src="stimuli/shtulman_2012_scientific_statements.js"></script>
</head>

<body></body>

<script>
/* ----------------------------------
   INITIALIZE JSPRCH
---------------------------------- */

var jsPsych = initJsPsych({
  on_finish: function () {
    jsPsych.data.displayData();
  }
});

var timeline = [];

/* ----------------------------------
   FULLSCREEN
---------------------------------- */

timeline.push({
  type: jsPsychFullscreen,
  fullscreen_mode: true
});

/* ----------------------------------
   WELCOME
---------------------------------- */

timeline.push({
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `
    <p>Welcome to the experiment.</p>
    <p>You will see several statements about science or math.</p>
    <p>Press <b>Z</b> if you think the statement is <b>true</b>.</p>
    <p>Press <b>M</b> if you think the statement is <b>false</b>.</p>
    <p>Press any key to begin.</p>
  `
});

/* ----------------------------------
   PARTICIPANT ID
---------------------------------- */

timeline.push({
  type: jsPsychSurveyText,
  questions: [
    {
      prompt: "Please enter your participant ID (e.g., p1):",
      name: "participant_id"
    }
  ],
  on_finish: function (data) {
    jsPsych.data.addProperties({
      participant_id: data.response.participant_id
    });
  }
});

/* ----------------------------------
   STATEMENT TRIAL TEMPLATE
---------------------------------- */

var statement_trial = {
  type: jsPsychHtmlKeyboardResponse,
  prompt: "<p>Press <b>Z</b> for true, <b>M</b> for false.</p>",
  stimulus: function () {
    return "<b><font size='6'>" +
      jsPsych.timelineVariable('Statement') +
      "</font></b>";
  },
  choices: ['z', 'm'],
  data: {
    category: jsPsych.timelineVariable('Category'),
    correct_response: jsPsych.timelineVariable('T2'),
    naive_theory: jsPsych.timelineVariable('T1')
  },
  on_finish: function (data) {
    data.is_consistent = data.naive_theory === data.correct_response;

    if (data.response === "z") {
      data.response_tf = "T";
    } else if (data.response === "m") {
      data.response_tf = "F";
    }

    data.correct = data.response_tf === data.correct_response;
  }
};

/* ----------------------------------
   CATEGORY BLOCKS
---------------------------------- */

// get unique categories
var categories = [...new Set(scientific_statements.map(x => x.Category))];
categories = jsPsych.randomization.shuffle(categories);

categories.forEach(function (category) {

  // category intro screen
  timeline.push({
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
      <p>Next, you will see statements about <b>${category}</b>.</p>
      <p>Press any key to continue.</p>
    `
  });

  // filter statements for this category
  var category_statements = scientific_statements.filter(
    x => x.Category === category
  );

  // randomize within category
  category_statements = jsPsych.randomization.shuffle(category_statements);

  // push trials
  timeline.push({
    timeline: [statement_trial],
    timeline_variables: category_statements
  });

});

/* ----------------------------------
   END OF TASK MESSAGE
---------------------------------- */

timeline.push({
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `
    <p>Thank you for completing this portion of the experiment.</p>
    <p>We now have a few questions for you.</p>
    <p>Press any key to continue.</p>
  `
});

/* ----------------------------------
   DEMOGRAPHICS
---------------------------------- */

timeline.push({
  type: jsPsychSurvey,
  survey_json: {
    showQuestionNumbers: false,
    elements: [
      {
        type: 'text',
        title: "What is your age?",
        name: 'age'
      },
      {
        type: 'multi-choice',
        title: "What is your grade level?",
        name: 'grade',
        options: [
          '1st Year', '2nd Year', '3rd Year',
          '4th Year', '5th Year', 'Other'
        ]
      },
      {
        type: 'multi-choice',
        title: "What is your gender?",
        name: 'gender',
        options: [
          'Male', 'Female', 'Non-binary',
          'Prefer not to say', 'Other'
        ]
      },
      {
        type: 'text',
        title: "What is your major?",
        name: 'major'
      },
      {
        type: 'text',
        title: "What do you think this experiment was about?",
        name: 'experiment_topic'
      },
      {
        type: 'text',
        title: "Did you experience any technical difficulties?",
        name: 'technical_difficulties'
      }
    ]
  }
});

/* ----------------------------------
   DEBRIEF
---------------------------------- */

timeline.push({
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `
    <p>That is the end of the experiment.</p>
    <p>Thank you for participating!</p>
    <p>This study investigates how people reason about scientific concepts.</p>
  `
});

/* ----------------------------------
   RUN EXPERIMENT
---------------------------------- */

jsPsych.run(timeline);
</script>
</html>
